@(user: LoginIdentity)(implicit flash: Flash)

@import org.joda.time.DateTime
@main("API", Some(user)) {

  <h1>API</h1>

  <p>This page documents the JSON-based REST API, for programmatic access to data. The API is split into <em>resources:</em></p>

  <ul>
    <li><a href="#licensees">Licensees</a></li>
    <li><a href="#licensee">Licensee details</a></li>
    <li><a href="#organizations">Organizations</a></li>
    <li><a href="#organization">Organization details</a></li>
    <li><a href="#people">People</a></li>
    <li><a href="#person">Person details</a></li>
  </ul>


  <h2>Security</h2>

  <h3>Authentication</h3>

  <p>All API requests require authentication using a user-specific token. Yours is <code>@user.apiToken</code>.
  You need to pass this token on all requests by adding the <code>api_token</code> query string parameter.</p>

  <table class="table-bordered table">
   <tr>
    <th>Example</th>
     <td><a href="/api/v1/organizations?api_token=@user.apiToken">GET /api/v1/organizations?api_token=@user.apiToken</a></td>
   </tr>
  </table>

  <h3> Markdown and XSS attacks</h3>

  <p>Certain fields in this API contain content formatted in <a href="http://daringfireball.net/projects/markdown/">Markdown</a>.
    Markdown is a plain-text mark-up language, used for generating HTML, that may also contain HTML tags. A web page
    that embeds HTML generated from user-entered Markdown is at risk of
    <a href="https://www.owasp.org/index.php/Cross-site_Scripting_(XSS)">XSS attacks</a>, a significant security risk.
    However, the risk is low for this application, because malicious users are less likely than for public applications.</p>

  <p>Any HTML tags in a piece of Markdown will end up in the HTML output verbatim. This means that it is possible to put <code>&lt;script&gt;</code> tags
    inside Markdown content, and have any JavaScript code run on any page that embeds that output. For
    <a href="http://michelf.ca/blog/2010/markdown-and-xss/">various technical reasons</a>, it is not possible to
    sanitize Markdown input to guard against this. Therefore, <strong>all HTML <em>output</em> generated by
    Markdown processors <em>must</em> be sanitized.</strong> There are various libraries available to help you clean
    HTML output. For example, there's <a href="http://jsoup.org/cookbook/cleaning-html/whitelist-sanitizer">jsoup</a>
    for Java, <a href="http://sourceforge.net/projects/kses/">kses</a> for PHP, and
    <a href="https://github.com/rgrove/sanitize">Sanitize</a> for Ruby.</p>


  <h2>HTTP resources</h2>

  <h3 id="licensees">Licensees</h3>

  <p>The <em>licensees</em> resource is a list of licensees for a particular brand, optionally filtered by date.</p>

  <table class="table table-bordered">
    <tr>
      <th>Request</th>
      <td><code>GET /api/v1/licensees/{brand}</code></td>
    </tr>
    <tr>
      <th>Request path parameters</th>
      <td>
        <code>brand</code> a brand code to return licensees for, e.g. <code>mgt30</code>
      </td>
    </tr>
    <tr>
      <th>Request query string parameters (optional)</th>
      <td><code>date</code> a date to filter licensees for licenses active on that date, in YYYY-MM-DD format, default today</td>
    </tr>
    <tr>
      <th>Response content type</th>
      <td><code>application/json; charset=utf-8</code></td>
    </tr>
    <tr>
      <th>Response body</th>
      <td>
        <p>A JSON array of licensee objects, with properties:</p>
        <ul>
          <li><code>country</code> - ISO 8166-2 country code</li>
          <li><code>first_name</code></li>
          <li><code>last_name</code></li>
        </ul>
      </td>
    </tr>
    <tr>
      <th>Errors (HTTP status)</th>
      <td>
        <p><code>404 Not Found</code> if the given brand code is not defined</p>
      </td>
    </tr>
    <tr>
      <th>Examples</th>
      <td>
        <a href="/api/v1/licensees/mgt30?api_token=@user.apiToken">GET /api/v1/licensees/mgt30</a>
        <br><a href="/api/v1/licensees/mgt30?date=2013-01-01&api_token=@user.apiToken">GET /api/v1/licensees/mgt30?date=2013-01-01</a>
      </td>
    </tr>
  </table>


  <h3 id="licensee">Licensee details</h3>

  <p>The <em>licensee details</em> resource provides more details about an entry in the <a href="#licensees">list</a>.</p>

  <table class="table table-bordered">
    <tr>
      <th>Request</th>
      <td><code>GET /api/v1/licensee/{licenseeId}/brand/{brand}</code></td>
    </tr>
    <tr>
      <th>Request path parameters</th>
      <td>
        <p><code>licenseeId</code> unique identifier for the person with the content license, e.g. <code>42</code></p>
        <p><code>brand</code> a brand code to return licensees for, e.g. <code>mgt30</code></p>
      </td>
    </tr>
    <tr>
      <th>Request query string parameters</th>
      <td>none</td>
    </tr>
    <tr>
      <th>Response content type</th>
      <td><code>application/json; charset=utf-8</code></td>
    </tr>
    <tr>
      <th>Response body</th>
      <td>
        <p>A JSON object, with licensee properties:</p>
        <ul>
          <li><code>country</code> - ISO 8166-2 country code</li>
          <li><code>first_name</code></li>
          <li><code>last_name</code></li>
          <li><code>email_address</code></li>
          <li><code>twitter_handle</code> - Twitter user name, without the leading <code>@@</code></li>
          <li><code>facebook_url</code></li>
          <li><code>linkedin_url</code></li>
          <li><code>google_plus_url</code></li>
          <li><code>bio</code> - Markdown format</li>
          <li><code>interests</code> - Markdown format</li>
          <li><code>valid</code> <code>true</code> - when there is a current license for this person and brand</li>
          <li><code>licensed_since</code> - earliest start date for a current license for this person and brand</li>
        </ul>
      </td>
    </tr>
    <tr>
      <th>Errors (HTTP status)</th>
      <td>
        <p><code>404 Not Found</code> if the specified licensee is not found or if given brand code is not defined</p>
      </td>
    </tr>
    <tr>
      <th>Examples</th>
      <td>
        <a href="/api/v1/licensee/20/brand/BXLXS?api_token=@user.apiToken">GET /api/v1/licensee/20/brand/BXLXS</a>
        <br><a href="/api/v1/licensee/1/brand/mgt30?api_token=@user.apiToken">GET /api/v1/licensee/1/brand/mgt30</a>
      </td>
    </tr>
  </table>


  <h3 id="organizations">Organizations</h3>

  <table class="table table-bordered">
    <tr>
      <th>Description</th>
      <td>A list of Happy Melly legal entities - organizations that are not legal entities are not included</td>
    </tr>
    <tr>
      <th>Request</th>
      <td><code>GET /api/v1/organizations</code></td>
    </tr>
    <tr>
      <th>Request path parameters</th>
      <td>none</td>
    </tr>
    <tr>
      <th>Request query string parameters</th>
      <td><code>legal_entities_only</code> boolean, set to <code>true</code> to only include organizations that are legal entities, default <code>false</code></td>
    </tr>
    <tr>
      <th>Response content type</th>
      <td><code>application/json; charset=utf-8</code></td>
    </tr>
    <tr>
      <th>Response body</th>
      <td>
        <p>A JSON array of organization objects, with properties:</p>
        <ul>
          <li><code>href</code> - URL of the <a href="#organization">organization details</a> resource, excluding protocol/host and starting with <code>/api</code></li>
          <li><code>name</code></li>
          <li><code>city</code></li>
          <li><code>country</code> - ISO 8166-2 country code</li>
        </ul>
      </td>
    </tr>
    <tr>
      <th>Errors (HTTP status)</th>
      <td>none</td>
    </tr>
    <tr>
      <th>Example</th>
      <td><a href="/api/v1/organizations?api_token=@user.apiToken">GET /api/v1/organizations</a>
      <br><a href="/api/v1/organizations?api_token=@user.apiToken&legal_entities_only=true">GET /api/v1/organizations?legal_entities_only=true</a></td>
    </tr>
  </table>


  <h3 id="organization">Organization details</h3>

  <p>The <em>organization details</em> resource provides more details about an entry in the <a href="#organizations">list</a>.</p>

  <table class="table table-bordered">
    <tr>
      <th>Request</th>
      <td><code>GET /api/v1/organization/{organizaionId}</code></td>
    </tr>
    <tr>
      <th>Request path parameters</th>
      <td><code>organizaionId</code> unique identifier for the organization, e.g. <code>42</code></td>
    </tr>
    <tr>
      <th>Request query string parameters</th>
      <td>none</td>
    </tr>
    <tr>
      <th>Response content type</th>
      <td><code>application/json; charset=utf-8</code></td>
    </tr>
    <tr>
      <th>Response body</th>
      <td>
        <p>A JSON object, with organization properties:</p>
        <ul>
          <li><code>name</code></li>
          <li><code>address</code> - address object with properties:
            <ul>
              <li><code>street1</code></li>
              <li><code>street1</code></li>
              <li><code>city</code></li>
              <li><code>province</code></li>
              <li><code>post_code</code></li>
              <li><code>country</code> - ISO 8166-2 country code</li>
            </ul>
          </li>
          <li><code>vat_number</code></li>
          <li><code>registration_number</code></li>
          <li><code>category</code> - <code>brandentity</code> or <code>legalentity</code></li>
          <li><code>members</code> - array of objects with properties:
            <ul>
              <li><code>first_name</code></li>
              <li><code>last_name</code></li>
              <li><code>country</code> - ISO 8166-2 country code</li>
            </ul>
          </li>
        </ul>
      </td>
    </tr>
    <tr>
      <th>Errors (HTTP status)</th>
      <td>
        <p><code>404 Not Found</code> if the specified organization is not found</p>
      </td>
    </tr>
    <tr>
      <th>Examples</th>
      <td>
        <a href="/api/v1/organization/1?api_token=@user.apiToken">GET /api/v1/organization/1</a>
      </td>
    </tr>
  </table>


  <h3 id="people">People</h3>
  <table class="table table-bordered">
    <tr>
      <th>Description</th>
      <td>A list of Happy Melly People, optionally filtered by their stakeholder and/or board member status</td>
    </tr>
    <tr>
      <th>Request</th>
      <td><code>GET /api/v1/people</code></td>
    </tr>
    <tr>
      <th>Request path parameters</th>
      <td>none</td>
    </tr>
    <tr>
      <th>Request query string parameters</th>
      <td><p><code>stakeholders_only</code> boolean, set to <code>true</code> to only include people that are HM stakeholders, default <code>false</code></p>
        <p><code>board_members_only</code> boolean, set to <code>true</code> to only include people that are HM board members, default <code>false</code></p>
        <p>Both parameters can be combined to get a list of people that only contains stakeholder who are also board members.</p>
      </td>
    </tr>
    <tr>
      <th>Response content type</th>
      <td><code>application/json; charset=utf-8</code></td>
    </tr>
    <tr>
      <th>Response body</th>
      <td>
        <p>A JSON array of organization objects, with properties:</p>
        <ul>
          <li><code>href</code> - URL of the <a href="#person">person details</a> resource, excluding protocol/host and starting with <code>/api</code></li>
          <li><code>name</code></li>
          <li><code>city</code></li>
          <li><code>country</code> - ISO 8166-2 country code</li>
        </ul>
      </td>
    </tr>
    <tr>
      <th>Errors (HTTP status)</th>
      <td>none</td>
    </tr>
    <tr>
      <th>Examples</th>
      <td><a href="/api/v1/people?api_token=@user.apiToken">GET /api/v1/people</a><br>
      <a href="/api/v1/people?api_token=@user.apiToken&stakeholders_only=true">GET /api/v1/people?stakeholders_only=true</a><br>
      <a href="/api/v1/people?api_token=@user.apiToken&stakeholders_only=true&board_members_only=true">GET /api/v1/people?stakeholders_only=true&board_members_only=true</a></td>
    </tr>
  </table>

  
  <h3 id="person">Person details</h3>
  
  <table class="table table-bordered">
    <tr>
      <th>Description</th>
      <td>Details for a single person</td>
    </tr>
    <tr>
      <th>Request</th>
      <td><code>GET /api/v1/person/{id}</code></td>
    </tr>
    <tr>
      <th>Request path parameters</th>
      <td><code>id</code> unique identifier for the person, e.g. <code>42</code></td>
    </tr>
    <tr>
      <th>Query string parameters</th>
      <td>none</td>
    </tr>
    <tr>
      <th>Response content type</th>
      <td><code>application/json; charset=utf-8</code></td>
    </tr>
    <tr>
      <th>Response body</th>
      <td>
        <p>A JSON person object, with properties:</p>
        <ul>
          <li><code>first_name</code></li>
          <li><code>last_name</code></li>
          <li><code>email_address</code></li>
          <li><code>address</code> address object:
            <ul>
              <li><code>street1</code></li>
              <li><code>street2</code></li>
              <li><code>city</code></li>
              <li><code>post_code</code></li>
              <li><code>province</code></li>
              <li><code>country</code> - ISO 8166-2 country code</li>
            </ul>
          </li>
          <li><code>stakeholder</code></li>
          <li><code>board_member</code></li>
          <li><code>bio</code> Markdown format</li>
          <li><code>interests</code> Markdown format</li>
          <li><code>twitter_handle</code> - Twitter user name, without the leading <code>@@</code></li>
          <li><code>facebook_url</code></li>
          <li><code>linkedin_url</code></li>
          <li><code>google_plus_url</code></li>
          <li><code>active</code></li>
          <li><code>created</code> - ISO8601 date time, e.g. <code>@DateTime.now().toString()</code></li>
          <li><code>createdBy</code></li>
          <li><code>updated</code> - ISO8601 date time, e.g. <code>@DateTime.now().toString()</code></li>
          <li><code>updatedBy</code></li>
          <li><code>organizations</code> - JSON array of organization objects, with the same structure as the <a href="#organizations">organizations resource</a></li>
          <li><code>licenses</code> - JSON array of license objects, with properties:
            <ul>
              <li><code>brand</code> - a brand code</li>
              <li><code>start</code> - date in `YYYY-MM-DD` format</li>
              <li><code>end</code> - date in `YYYY-MM-DD` format</li>
            </ul>
          </li>
        </ul>
      </td>
    </tr>
    <tr>
      <th>Errors (HTTP status)</th>
      <td>
        <p><code>404 Not Found</code> if the specified person is not found</p>
      </td>
    </tr>
    <tr>
      <th>Example</th>
      <td>
        <a href="/api/v1/person/@user.person.id.get?api_token=@user.apiToken">GET /api/v1/person/@user.person.id.get</a>
      </td>
    </tr>
  </table>

}
