@import models.repository.Repositories
@(user: ActiveUser,
    brand: Brand,
    brands: List[Brand],
    funders: List[Organisation],
    event: Event,
    view: InvoiceView,
    typeName: String,
    fees: List[(String, String)],
    deletable: Boolean)(implicit
        request: Request[Any],
        flash: Flash,
        handler: be.objectify.deadbolt.scala.DeadboltHandler,
        token: play.filters.csrf.CSRF.Token,
        services: Repositories)

@import templates.Formatters._
@import views.Countries
@import views.ViewHelpers.dateInterval
@import controllers.Utilities

@v2.main(event.title + " - Event", "events", user, withMelly = true) {
  @v2.element.brandHeader(brand, brands, "events", small = true, facilitator = user.account.isFacilitatorNow) {
    <span><a href="@routes.Events.index(brand.identifier)">Events</a></span>
  }
  <input type="hidden" disabled id="brandId" value="@event.brandId"/>
  <input type="hidden" disabled id="eventId" value="@event.id"/>

  <div class="row page-content">
    <div class="container">
      <div class="row event-details  content-block">
        <div class="col-md-9">
          @views.html.v2.event.requestEvaluation(event, event.facilitatorIds(services).head, brand.evaluationUrl)
          <div class="header-block">
            <div class="row">
              <div class="col-md-12"><h2>@event.title</h2></div>
              <div class="col-md-6">
                @dateInterval(event.schedule.start, event.schedule.end)
                @if(event.location.online) {
                  online
                } else {
                  in @event.location.city, @Countries.name(event.location.countryCode)
                }
              </div>
              <div class="col-md-4">
                Event Rating @views.html.v2.element.rating(event.rating)
              </div>
            </div>
          </div>
          <div class="header-block">
            <div class="row">
              <div class="col-md-12">
                <div class="buttons">
                  <div class="buttons-block">
                    @if(!event.confirmed) {
                      <a href="#" data-id="@event.identifier" class="btn btn-primary event-confirm">
                        Confirm
                      </a>
                    } else {
                      <a href="#" class="btn btn-primary" disabled="disabled">Confirmed</a>
                    }
                    <a class="btn btn-default" href="@routes.Events.edit(event.id.get)">
                      Edit
                    </a>
                  </div>
                  <div class="buttons-block">
                    <a class="btn btn-default" href="@routes.Events.duplicate(event.id.get)">
                      Duplicate
                    </a>
                    <a data-id="@event.identifier" class="btn btn-default event-cancel"
                      id="cancelButton" @if(!deletable) {disabled="disabled"} >Cancel</a>
                  </div>
                </div>
              </div>
            </div>
          </div>
          @if(user.account.isCoordinatorNow) {
            @if(!event.schedule.validateTotalHours) {
              <div class="alert alert-warning">
                <i class="glyphicon glyphicon-info-sign"></i> Number of <b>total hours</b> is
                suspiciously less than a number of hours per day multiplied to a number of days.
              </div>
            }
          }
        </div>
        <div class="col-md-9">
          <div class="row">
            <div class="col-md-12 event-info">
            <div class="column">
              <div class="title">Facilitators</div>
              @for(facilitator <- event.facilitators(services)) {
                <a href="@controllers.core.routes.People.details(facilitator.id.getOrElse(0))">
                  @element.photo(facilitator, "70")
                </a>
                <span class="name">@facilitator.fullName</span><br/>
              }
            </div>
            <div class="column">
              <div class="title">Event rundown</div>
              <div class="column">
                <dt>Spoken Language</dt>
                <dd>@event.spokenLanguage</dd>
                @event.materialsLanguage.map { language =>
                  <dt>Materials in</dt>
                  <dd>@language</dd>
                }
                <dt>Hours</dt>
                <dd>@event.schedule.totalHours (per day: @event.schedule.hoursPerDay)</dd>
              </div>
              <div class="column">
                <dt class="text-muted">Event type</dt>
                <dd>@typeName</dd>
                <dt class="text-muted">Organizer</dt>
                <dd id="organizer" data-id="@event.organizer.id"></dd>
              </div>
            </div>
          </div>
          </div>
          <div class="row">
            <div class="col-md-12">
              @defining(event.pageUrl(routes.Events.public(event.hashedId).url)) { maybeUrl =>
                  @maybeUrl.map { url =>
                    <span class="text-muted">Website: </span> <a href="@url" target="_blank">@url</a> <br/>
                  }
              }
              @event.organizer.registrationPage.map { url =>
                <span class="text-muted">Registration: </span><a href="@url" target="_blank">@url</a><br/>
              }
              <br/>
              @event.details.description.map { desc =>
                <span class="text-muted">Description: </span>@desc.markdown<br/>
              }
              @event.details.specialAttention.map { attention =>
                <span class="text-muted">Special attention: </span>@attention.markdown<br/>
              }
            </div>
          </div>
          @views.html.element.brandFees(brand.name, fees)
        </div>
        @views.html.v2.event.invoice(user, funders, event, view)
        <div class="col-md-12">
          <div class="table-title">
            <div class="pull-left">
              <span class="name">Attendees</span>
            </div>
            <div class="pull-right">
              <a tabindex="-1"
              href="@controllers.event.routes.Attendees.add(event.identifier)" title="Add Attendee">
                Add Attendee</a>
              @if(brand.evaluationUrl.isDefined) {
                  <a tabindex="-1" href="#request" data-toggle="modal" title="Request Evaluation">
                      Send Evaluation Request</a>
              } else {
                  <span data-toggle="tooltip" data-placement="top"
                    title="Ask your brand coordinator to set an evaluation url to send evaluation requests">Send Evaluation Request</span>
              }
              <a id="exportLink" href="" title="Only evaluations, currently visible in the table, will be exported">
                Export to XLSX</a>
            </div>
          </div>
          <table id="participants" class="datatables table table-rowed">
            <thead>
              <tr>
                <th>Attendee</th>
                <th align="center" id="impression"></th>
                <th>Evaluation Date</th>
                <th>Handled Date</th>
                <th>Certificate Number</th>
                <th></th>
              </tr>
            </thead>
          </table>
        </div>
      </div>
    </div>
  </div>
  <script src="@routes.Assets.at("js/participant.js")" type="text/javascript"></script>
  <script src="@routes.Assets.at("js/element/events.js")" type="text/javascript"></script>


  <script src="@routes.Assets.at("js/event/widgets-details/evaluation-dlg.js")" type="text/javascript"></script>
  <script src="@routes.Assets.at("js/event/details-page.js")" type="text/javascript"></script>

  <link rel="stylesheet" href="@routes.Assets.at("css/events/events-detail.css")">
}
