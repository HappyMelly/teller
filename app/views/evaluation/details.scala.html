@(user: ActiveUser,
    pair: EvaluationPair,
    participantName: String,
    withCertificate: Boolean,
    facilitator: Boolean,
    endorsement: Option[Endorsement])(implicit request: Request[Any],
    flash: Flash,
    handler: AuthorisationHandler,
    token: play.filters.csrf.CSRF.Token)

@import helper.CSRF
@import be.objectify.deadbolt.scala.views.html._
@import UserRole.DynamicRole
@import views.Evaluations

@main("Evaluation for %s".format(participantName), "participants", user) {

  @element.evaluationActions()
  <div class="page-header">
    <h1>
      Evaluation for @participantName
      <div class="actions pull-right">
        @dynamic(handler, "evaluation", DynamicRole.Coordinator) {
          <div class="button">
            <a class="btn btn-default" href="@routes.Evaluations.edit(pair.eval.id.get)">
              <i class="glyphicon glyphicon-pencil"></i> Edit
            </a>
          </div>
        }
        @dynamic(handler, "evaluation", DynamicRole.Facilitator) {
          <div class="button">
            @if(withCertificate) {
              <button class="btn btn-default" tabindex="-1"
              href="@CSRF(routes.Certificates.create(pair.eval.eventId, pair.eval.personId))"
              type="submit">
                <i class="glyphicon glyphicon-white glyphicon-file"></i>
                Generate Certificate
              </button>
            }
            <button class="move btn btn-success" tabindex="-1" href="#move"
            data-href="@routes.Evaluations.move(pair.eval.id.getOrElse(0))"
            data-brand="@pair.event.brandId"
            data-toggle="modal" type="submit">
              <i class="glyphicon glyphicon-white glyphicon-random"></i> Move
            </button>
            @if(pair.eval.approvable) {
              <button class="approve btn btn-success" tabindex="-1" href="#approve"
              data-href="@CSRF(routes.Evaluations.approve(pair.eval.id.getOrElse(0)))"
              data-toggle="modal" type="submit">
                <i class="glyphicon glyphicon-white glyphicon-thumbs-up"></i>
                Approve
              </button>
            }
            @if(pair.eval.rejectable) {
              <button class="reject btn btn-warning" tabindex="-1" href="#reject"
              data-href="@CSRF(routes.Evaluations.reject(pair.eval.id.getOrElse(0)))"
              data-toggle="modal" type="submit">
                <i class="glyphicon glyphicon-white glyphicon-thumbs-down"></i>
                Reject
              </button>
            }
          </div>
          <div class="button">
            <form class="delete" class="form-inline" method="get" text="evaluation"
            action="@CSRF(routes.Evaluations.delete(pair.eval.id.getOrElse(0)))">
              <button class="btn btn-danger" type="submit">
                <i class="glyphicon glyphicon-white glyphicon-trash"></i> Delete
              </button>
            </form>
          </div>
        }
      </div>
    </h1>
  </div>
  @if(pair.eval.status == EvaluationStatus.Rejected) {
    <div class="alert alert-warning">
      <i class="glyphicon glyphicon-warning-sign"></i> This evaluation is <strong>
      rejected</strong></div>
  }
  @if(pair.eval.approved) {
    <div class="alert alert-success">
      <i class="glyphicon glyphicon-ok-sign"></i> This evaluation is <strong>
      approved</strong></div>
  }

  <div class="col-md-8">
    <strong>Event</strong><br/>
    <a href="@routes.Events.details(pair.event.id.get)">@pair.event.title</a>
  </div>
  <div class="col-md-12">
    <h3>Facilitator</h3>
    <dl>
      <dt>Impression</dt>
      <dl>@Evaluations.impression(pair.eval.facilitatorImpression)</dl>
      <dt>@Evaluations.Questions.facilitatorReview</dt>
      <dl>@pair.eval.facilitatorReview
        <br/>
        @if(facilitator) {
          @endorsement.map { x =>
          <a id="endorsement" class="remove" href="@routes.Endorsements.remove(user.person.identifier, x.id.get)">Remove Endorsement</a>
          }.getOrElse {
            <a id="endorsement" class="add" href="@routes.Endorsements.createFromEvaluation(pair.event.identifier, pair.eval.identifier)">Add as Endorsement</a>
          }
        }
      </dl>
    </dl>
  </div>
  <div class="col-md-12">
    <h3>Event & Participant</h3>
    <dl>
      <dt>Recommendation</dt>
      <dl>@Evaluations.recommendation(pair.eval.recommendationScore)</dl>
      <dt>Reason to register</dt>
      <dl>@pair.eval.reasonToRegister</dl>
      <dt>Action items</dt>
      <dl>@pair.eval.actionItems</dl>
      <dt>@Evaluations.Questions.changesToEvent</dt>
      <dl>@pair.eval.changesToEvent</dl>
    </dl>
  </div>
  <div class="col-md-12">
    <h3>Organizer</h3>
    <dl>
      @pair.eval.hostImpression.map { impression =>
        <dt>Impression</dt>
        <dl>@Evaluations.impression(impression)</dl>
      }
      <dt>@Evaluations.Questions.changesToHost</dt>
      <dl>@pair.eval.changesToHost</dl>
    </dl>
  </div>
  <div class="col-md-12">
    <h3>Content</h3>
    <dl>
      @pair.eval.contentImpression.map { impression =>
        <dt>Impression</dt>
        <dl>@Evaluations.impression(impression)</dl>
      }
      <dt>@Evaluations.Questions.changesToContent</dt>
      <dl>@pair.eval.changesToHost</dl>
    </dl>
  </div>
  <script type="text/javascript">
    var _serverData = {
      personId: @user.person.identifier,
      eventId: @pair.event.identifier,
      evaluationId: @pair.eval.identifier,
      endorsementId: @endorsement.map(_.id.get).getOrElse(0)
    };
  </script>
  <script src="@routes.Assets.at("evaluation/details.js")" type="text/javascript"></script>
}
